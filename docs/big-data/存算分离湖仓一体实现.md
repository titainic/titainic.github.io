---
layout: default
title: 存算分离湖仓一体实现
parent: Big Data
nav_order: 1
---

{: .highlight }
本章节详细介大数据存算分离湖仓一体实现



{: .important-title }
> 主要完成如下功能
>
> Hadoop基于s3a协议整合MinIO
>
> Hive使用s3a协议对Hadoop整合MinIO建表读写数据
>
> Hive整合Iceberg基于s3a协议对Hadoop整合MinIO建表读写数据
> 
> Spark 整合hive,Iceberg,Hadoop,MinIO读写数据
> 
> Flink 整合hive,Iceberg,Hadoop,MinIO读写数据


## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

---

# 大数据组件版本
<div class="code-example" markdown="1">

| 组件      | 版本     | 
|:--------|:-------|
| hadoop  | 3.3.3  | 
| hive    | 3.1.3  |
| iceberg | 1.3.0  | 
| spark   | 3.3.2  | 
| flink   | 1.17.1 | 

</div>

---
# 软件架构
{: .fs-9 }

部署分两块：计算集群和存储集群，使用AWS s3a协议进行存储集群和计算集群的链接
{: .fs-6 .fw-300 }

![](../../../assets/images/bigdata/bigdata.png)


---
# 硬件架构
{: .fs-9 }

| 设备          | 配置      | ssd  | 数量  |
|:------------|:--------|:-----|:----|
| 树莓派4B       | 8G内存    |      | 8   |
| nanopi neo3 | 2G内存    | 128G | 9   |
| 交换机         | 千兆,24网口 |      | 1   |
| 路由器         | 家用路由器   |      | 1   |

---


{: .note-title }
> 部署说明 :
>
> binend1-binend8 部署计算集群: hadoop,spark,flink,hive
>
> binend9 部署:sidekick, minio大数据场景下负载分发
>
> binend10-binend17 存储使用 minio集群

 
{: .highlight }
资源划分,IP分配，和部署清单

<div class="code-example" markdown="1">

| 硬件          | hosts    | ip           | 组件部署                                                                     |
|:------------|:---------|:-------------|:-------------------------------------------------------------------------|
| 树莓派4B       | binend1  | 10.168.1.101 | Hadoop(NameNode,ResourceManager),Spark(Master),Flink(JobManager)         |
| 树莓派4B       | binend2  | 10.168.1.102 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager)            |
| 树莓派4B       | binend3  | 10.168.1.103 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager)            |
| 树莓派4B       | binend4  | 10.168.1.104 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager),Hive       |
| 树莓派4B       | binend5  | 10.168.1.105 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager)            |
| 树莓派4B       | binend6  | 10.168.1.106 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager)            |
| 树莓派4B       | binend7  | 10.168.1.107 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager),mysql      |
| 树莓派4B       | binend8  | 10.168.1.108 | Hadoop(DataNode,NodeManager),Spark(Worker),Flink(TaskManager)            |
| nanopi neo3 | binend9  | 10.168.1.109 | sidekick                                                                 |
| nanopi neo3 | binend10 | 10.168.1.110 | minio                                                                    |
| nanopi neo3 | binend11 | 10.168.1.111 | minio                                                                    |
| nanopi neo3 | binend12 | 10.168.1.112 | minio                                                                    |
| nanopi neo3 | binend13 | 10.168.1.113 | minio                                                                    |
| nanopi neo3 | binend14 | 10.168.1.114 | minio                                                                    |
| nanopi neo3 | binend15 | 10.168.1.115 | minio                                                                    |
| nanopi neo3 | binend16 | 10.168.1.116 | minio                                                                    |
| nanopi neo3 | binend17 | 10.168.1.117 | minio                                                                    |

</div>

---

# MinIO集群部署+sidekick

{: .highlight }
MinIO集群部署参考官方部署:

```yaml
https://www.minio.org.cn/docs/cn/minio/linux/index.html
```

8个节点，每个节点挂载一个128G的SSD
{: .label .label-green }

![](../../../assets/images/bigdata/minio-1.jpg)

minio集群启动成功以后，可以看到每个节点都挂载了一个SSD和存储使用情况
{: .label .label-blue }
![](../../../assets/images/bigdata/minio-2.jpg)


---
sidekick是minio团队开源的负载均衡器，是以sidecar 模式运行的，主要是减少中心化负载均衡器的压力，同时也添加了对于dns故障的管理，sidekick会通过http error状态以及readiness api自动避免发送流量到故障节点。

{: .highlight }
sidekick参考官方如下部署:

```yaml
# github地址
https://github.com/minio/sidekick
```

注意启动hosts与上面分配hosts相对应
{: .label .label-yellow }
![](../../../assets/images/bigdata/sidekick.jpg)

---

# Spark,Hadoop,Hive使用s3a协议配置MinIO

{: .highlight }
参照MinIO官网配置集群

```yaml
https://www.minio.org.cn/docs/cn/minio/linux/integrations/disaggregated-spark-and-hadoop-hive-with-minio.html
```

官网翻译的没有去年好。感觉就是copy英语，然后找个翻译直接转换成中文了，很多翻译错误
{: .label .label-red }


# hive+hadoop+minio

# hive+iceberg+hadoop+minio

# spark+hive+iceberg+hadoop+minio

# flink+hive+iceberg+hadoop+minio


